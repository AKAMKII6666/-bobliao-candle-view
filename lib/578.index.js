!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.candleView=t():e.candleView=t()}(this,(()=>(()=>{"use strict";function e(e,r){if(e){if("string"==typeof e)return t(e,r);var i={}.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?t(e,r):void 0}}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}var r=self;return r.addEventListener("message",(function(i){var n,o,a,u,s,c,l,d,m,b,p,f,h,g=i.data,N=function(e){if(Array.isArray(e))return t(e)}(h=g._xAxisdatatickArr)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(h)||e(h)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),y=Object.assign({},g._viewSize),x=Object.assign({},g._org_displayCandleMaxMin),v=g.isEscapeItems_current,w=g.isQuickUpdateing_current,k=g.allComputedCandleData_current,P=g.xAxis_initArgs_labelSpace,S=g.initArgs_candleStyles_wickFallColor,_=g.initArgs_candleStyles_candleFallColor,A=g.initArgs_candleStyles_wickRiseColor,M=g.initArgs_candleStyles_candleRiseColor,T=g.initArgs_candleStyles_candleWidth,L=g.initArgs_candleStyles_wickWidth,C=g.xAxis_data_displayTickCommonpixWidth,j=g.xAxis_data_lineSize_width,E=g.xAxis_data_x,W=function(e,t){return"string"==typeof e&&"auto"===e?t:"string"==typeof e&&-1!==e.indexOf("%")?t*(Number(e.replace("%",""))/100):"string"==typeof e&&-1!==e.indexOf("px")?Number(e.replace("px","")):"number"!=typeof e&&isNaN(Number(e))?(console.log("no useful length !"),0):Number(e)},I=function(e,t,r){if(Number(e)>Number(t)){if("wick"===r)return S;if("candle"===r)return _}return"wick"===r?A:"candle"===r?M:"#fff"},O=function(e,t,r){var i=Number(e.end)-Number(e.start),n=Number(((r-t)/i).toFixed(5));return(y.height-W(P,y.height))*n},F=function(e,t){var r=Number(e.end)-Number(e.start),i=Number(((Number(t)-Number(e.start))/r).toFixed(5)),n=y.height-W(P,y.height);return n-n*i},V=function(e,t){try{j-E-e.currentTick.pixSpace.start>=0&&e.currentTick.pixSpace.end-(j-E)<=e.currentTick.pixSpace.end-e.currentTick.pixSpace.start&&r.postMessage({state:!0,message:"setdisplayLatestCandle",data:e})}catch(e){}},z=function(e,t,i){if(e.candleColor=I(e.open,e.close,"candle"),e.wickColor=I(e.open,e.close,"wick"),1==w)e.wickWidth=1.2,e.candlePixPosition={x:0,y:F(t,Math.max(Number(e.close),Number(e.open)).toString())},e.wickPixPosition={x:0,y:F(t,e.high.toString())},e.wickLength=O(t,Number(e.low),Number(e.high));else{try{e.candleWidth=W(T,C),e.wickWidth=W(L,C)}catch(e){}e.candlePixPosition={x:0,y:F(t,Math.max(Number(e.close),Number(e.open)).toString())},e.wickPixPosition={x:0,y:F(t,e.high.toString())},e.candleLength=O(t,Math.min(Number(e.open),Number(e.close)),Math.max(Number(e.open),Number(e.close))),e.candleLength<1&&(e.candleLength=1),e.wickLength=O(t,Number(e.low),Number(e.high))}try{j-E-e.currentTick.pixSpace.start>=0&&e.currentTick.pixSpace.end-(j-E)<=e.currentTick.pixSpace.end-e.currentTick.pixSpace.start&&r.postMessage({state:!0,message:"setdisplayLatestCandle",data:e})}catch(e){}return e.updateTag=i.start+i.end,e},R=function(e,t){var r=t;return r>Number(e.open)&&(r=Number(e.open)),r>Number(e.close)&&(r=Number(e.close)),r>Number(e.high)&&(r=Number(e.high)),r>Number(e.low)&&(r=Number(e.low)),r},U=function(e,t){var r=t;return r<Number(e.open)&&(r=Number(e.open)),r<Number(e.close)&&(r=Number(e.close)),r<Number(e.high)&&(r=Number(e.high)),r<Number(e.low)&&(r=Number(e.low)),r},D=function(e){for(var t=[],r={start:"9999999999999999999999",end:"-9999999999999999999999"},i=-99999999999999,n=0;n<e.length;n++){var o=e[n];if(void 0!==k[o.value]){var a=k[o.value];a.currentTick=o,r.start=R(a,Number(r.start)).toString(),r.end=U(a,Number(r.end)).toString(),i<Number(a.volume)&&(i=Number(a.volume)),t.push(a)}}return{data:t,scope:r,maxVolume:i}}(N);if(0!==D.data.length){r.postMessage({state:!0,message:"updateYaxis",data:D.scope});var Q,Y=x.start+x.end,$={start:-1e16,end:99999999999999},q=0,B=function(t,r){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=e(t))){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,u=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var e=i.next();return u=e.done,e},e:function(e){s=!0,a=e},f:function(){try{u||null==i.return||i.return()}finally{if(s)throw a}}}}(D.data);try{for(B.s();!(Q=B.n()).done;){var G=Q.value;v?Number(q)%2?(void 0===G.updateTag||G.updateTag!==Y?G=z(G,x,x):V(G),G.isEscaped=!1):(V(G,D.scope),G.isEscaped=!0):(void 0===G.updateTag||G.updateTag!==Y?G=z(G,x,x):V(G),G.isEscaped=!1),w?(Number(null===(n=G.wickPixPosition)||void 0===n?void 0:n.y)+Number(G.wickLength)>$.start&&($.start=Number(null===(o=G.wickPixPosition)||void 0===o?void 0:o.y)+Number(G.wickLength)),Number(null===(a=G.wickPixPosition)||void 0===a?void 0:a.y)<$.end&&($.end=Number(null===(u=G.wickPixPosition)||void 0===u?void 0:u.y))):(Math.max(Number(null===(s=G.candlePixPosition)||void 0===s?void 0:s.y)+Number(G.candleLength),Number(null===(c=G.wickPixPosition)||void 0===c?void 0:c.y)+Number(G.wickLength))>$.start&&($.start=Math.max(Number(null===(l=G.candlePixPosition)||void 0===l?void 0:l.y)+Number(G.candleLength),Number(null===(d=G.wickPixPosition)||void 0===d?void 0:d.y)+Number(G.wickLength))),Math.min(Number(null===(m=G.candlePixPosition)||void 0===m?void 0:m.y),Number(null===(b=G.wickPixPosition)||void 0===b?void 0:b.y))<$.end&&($.end=Math.min(Number(null===(p=G.candlePixPosition)||void 0===p?void 0:p.y),Number(null===(f=G.wickPixPosition)||void 0===f?void 0:f.y)))),q++}}catch(e){B.e(e)}finally{B.f()}r.postMessage({state:!0,message:"finishWork",data:{orgMaxMiny:$,result:D}})}else r.postMessage({state:!1,message:"not found"})})),{}})()));